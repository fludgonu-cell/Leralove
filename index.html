<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–õ–µ—Ä–µ ‚ù§Ô∏è</title>

  <style>
    :root{
      --bg1:#0f1020; --bg2:#1a1b35;
      --card: rgba(255,255,255,.11);
      --card2: rgba(255,255,255,.07);
      --text: rgba(247,247,251,.94);
      --muted: rgba(247,247,251,.84);
      --accent:#ff4d8d;
      --accent2:#ffb3c7;
      --accent3:#ffd1a8;
      --shadow: 0 18px 60px rgba(0,0,0,.45);
      --radius: 22px;
    }
    *{ box-sizing:border-box; }

    body{
      margin:0;
      min-height:100dvh;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 10%, rgba(255,77,141,.23), transparent 60%),
        radial-gradient(900px 500px at 85% 20%, rgba(255,179,199,.16), transparent 55%),
        radial-gradient(800px 500px at 50% 120%, rgba(255,209,168,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      display:flex;
      justify-content:center;
      align-items:flex-start;
      padding: 18px;
      overflow:hidden;
    }

    #bgCanvas{ position:fixed; inset:0; pointer-events:none; z-index:0; }
    #fxCanvas{ position:fixed; inset:0; pointer-events:none; z-index:10; }

    .app{ width:min(780px,100%); position:relative; z-index:2; }

    .book{
      width:100%;
      height: min(780px, calc(100dvh - 36px));
      border-radius: var(--radius);
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.07));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
      backdrop-filter: blur(10px);
    }

    .topbar{
      display:flex; align-items:center; justify-content:space-between;
      padding: 14px 16px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      background: rgba(0,0,0,.12);
      backdrop-filter: blur(10px);
    }
    .badge{ display:inline-flex; gap:8px; align-items:center; font-size: 13px; color: rgba(247,247,251,.82); }
    .dot{ width:8px;height:8px;border-radius:999px; background: var(--accent); box-shadow: 0 0 18px rgba(255,77,141,.65); }
    .pill{ height:8px; width:170px; border-radius:999px; background: rgba(255,255,255,.12); overflow:hidden; }
    .pill > i{ display:block;height:100%; width:0%; background: linear-gradient(90deg, var(--accent), var(--accent2), var(--accent3)); }

    .stage{
      position:relative;
      height: calc(100% - 58px);
      padding: 18px;
      overflow:hidden;
    }

    .pageShell{
      width:min(720px,100%);
      height:100%;
      margin:0 auto;
      position:relative;
      border-radius: calc(var(--radius) - 6px);
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, var(--card), var(--card2));
      box-shadow: 0 12px 40px rgba(0,0,0,.32);
      overflow:hidden;
    }

    .page{
      position:absolute;
      inset:0;
      padding:22px;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      opacity:0;
      transform: translateX(18px);
      pointer-events:none;
    }

    .page.active{
      opacity:1;
      transform: translateX(0);
      pointer-events:auto;
      transition: opacity .55s ease, transform .55s ease;
    }

    .page.exitLeft{
      opacity:0;
      transform: translateX(-18px);
      transition: opacity .55s ease, transform .55s ease;
      pointer-events:none;
    }
    .page.exitRight{
      opacity:0;
      transform: translateX(18px);
      transition: opacity .55s ease, transform .55s ease;
      pointer-events:none;
    }

    /* ‚úÖ –§–æ–ª–±—ç–∫-—Ü–≤–µ—Ç–∞ (–¥–ª—è –Ø–Ω–¥–µ–∫—Å–∞ —Ç–æ—á–Ω–æ –±—É–¥—É—Ç –≤–∏–¥–Ω—ã) */
    h1,h2{ margin:0 0 10px 0; letter-spacing:.2px; line-height:1.15; }
    h1{
      font-size: clamp(28px, 3.6vw, 46px);
      color: rgba(255,255,255,.96);
      text-shadow: 0 12px 40px rgba(255,77,141,.10);
    }
    h2{
      font-size: clamp(22px, 2.8vw, 32px);
      color: rgba(255,179,199,.98);
    }

    /* ‚úÖ –ì—Ä–∞–¥–∏–µ–Ω—Ç –≤–∫–ª—é—á–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è */
    @supports (-webkit-background-clip: text) and (-webkit-text-fill-color: transparent) {
      h1{
        background: linear-gradient(90deg, #fff, var(--accent2), var(--accent));
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
      h2{
        background: linear-gradient(90deg, var(--accent2), #fff, var(--accent3));
        -webkit-background-clip:text;
        background-clip:text;
        -webkit-text-fill-color: transparent;
        color: transparent;
      }
    }

    p{ margin:10px 0; line-height:1.65; color:var(--muted); font-size:16px; }
    ul{ margin:10px 0 0 18px; color:var(--muted); line-height:1.65; }
    li{ margin:8px 0; }

    .hero{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      align-items:center;
    }
    @media (max-width:700px){ .hero{ grid-template-columns:1fr; } }

    .photo{
      aspect-ratio:4/3;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      overflow:hidden;
      background:
        radial-gradient(160px 160px at 18% 20%, rgba(255,77,141,.35), transparent 60%),
        radial-gradient(160px 160px at 80% 30%, rgba(255,209,168,.22), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.05));
      display:flex; align-items:center; justify-content:center;
      color: rgba(255,255,255,.80);
      font-size:14px;
      text-align:center;
      padding:10px;
    }
    .photo img{ width:100%; height:100%; object-fit:cover; display:block; }

    .controls{
      display:flex;
      gap:10px;
      justify-content:space-between;
      margin-top:16px;
      flex-wrap:wrap;
      align-items:center;
    }

    .btn{
      appearance:none;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.10);
      color: rgba(247,247,251,.92);
      padding:12px 14px;
      border-radius:14px;
      cursor:pointer;
      font-weight:800;
      letter-spacing:.2px;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 10px 30px rgba(0,0,0,.20);
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn:active{ transform: translateY(1px); }
    .btn.primary{
      background: linear-gradient(90deg, rgba(255,77,141,.95), rgba(255,179,199,.88), rgba(255,209,168,.78));
      border-color: rgba(255,255,255,.22);
      color:#1a1030;
    }
    .btn:disabled{ opacity:.45; cursor:not-allowed; }

    /* –º—É–∑—ã–∫–∞ */
    .music-chip{
      position:fixed;
      left:14px;
      bottom:14px;
      z-index:99999;
      display:none;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.28);
      backdrop-filter: blur(10px);
      color: rgba(247,247,251,.92);
      font-weight:900;
      cursor:pointer;
      -webkit-tap-highlight-color: transparent;
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    .music-chip.show{ display:inline-flex; }

    /* ===== –°–¢–ò–•: 4 —Å—Ç—Ä–æ–∫–∏, –±–µ–∑ –ø–µ—Ä–µ–Ω–æ—Å–∞ –ø–æ —Å–ª–æ–≤–∞–º ===== */
    .poem{
      text-align:center;
      font-size: clamp(20px, 3.3vw, 32px);
      line-height:1.55;
      font-weight:900;
      margin: 18px 0 10px 0;
      color: rgba(255,230,200,.98); /* —Ñ–æ–ª–±—ç–∫ */
      text-shadow: 0 10px 22px rgba(255,120,60,.10);
    }
    .poem .line{
      display:block;
      white-space: nowrap;     /* –Ω–µ –ª–æ–º–∞–µ–º —Å—Ç—Ä–æ–∫—É –Ω–∞ —Å–ª–æ–≤–∞ */
      word-break: keep-all;
      hyphens: none;
    }
    /* –µ—Å–ª–∏ —ç–∫—Ä–∞–Ω —Å–æ–≤—Å–µ–º —É–∑–∫–∏–π ‚Äî —á—É—Ç—å —É–º–µ–Ω—å—à–∏–º —Å—Ç–∏—Ö, —á—Ç–æ–±—ã –≤–ª–µ–∑ */
    @media (max-width: 380px){
      .poem{ font-size: 20px; }
    }

    /* –æ–≥–Ω–µ–Ω–Ω–∞—è –ª–∏–Ω–∏—è –∏–∑ —ç–º–æ–¥–∑–∏ */
    .fire-emoji{
      text-align:center;
      font-size: 22px;
      letter-spacing: 2px;
      margin: 6px 0 4px 0;
      filter: drop-shadow(0 10px 18px rgba(255,80,30,.12));
      user-select:none;
    }

    @media (max-width:360px){
      .pill{ width:135px; }
      .page{ padding:18px; }
    }
  </style>
</head>

<body>
  <canvas id="bgCanvas"></canvas>
  <canvas id="fxCanvas"></canvas>

  <audio id="bgm" src="song.mp3" preload="auto" loop></audio>
  <button class="music-chip" id="musicChip">üéµ –í–∫–ª—é—á–∏—Ç—å –º—É–∑—ã–∫—É</button>

  <main class="app">
    <section class="book">
      <div class="topbar">
        <div class="badge"><span class="dot"></span><span id="counter">–°—Ç—Ä–∞–Ω–∏—Ü–∞ 1 –∏–∑ 5</span></div>
        <span class="pill"><i id="bar"></i></span>
      </div>

      <div class="stage">
        <div class="pageShell">

          <!-- 1 -->
          <section class="page" data-i="0">
            <div class="hero">
              <div>
                <h1>–õ–µ—Ä–∞ ‚ù§Ô∏è</h1>
                <p>
                  –Ø —Å–¥–µ–ª–∞–ª —ç—Ç–æ—Ç –º–∞–ª–µ–Ω—å–∫–∏–π —Å–∞–π—Ç, —á—Ç–æ–±—ã —Ç—ã –º–æ–≥–ª–∞ –ª–∏—Å—Ç–∞—Ç—å –µ–≥–æ –∫–∞–∫ –∫–Ω–∏–≥—É.
                  –¢—É—Ç ‚Äî –º–æ–∏ —á—É–≤—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏–Ω–æ–≥–¥–∞ —Å–ª–æ–∂–Ω–æ —Å–∫–∞–∑–∞—Ç—å –≤—Å–ª—É—Ö, –Ω–æ –æ—á–µ–Ω—å –ª–µ–≥–∫–æ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π.
                </p>
                <p>üå∏üíóüå∑‚ú®</p>
              </div>
              <div class="photo">
                <img src="lera.jpg" alt="–õ–µ—Ä–∞">
              </div>
            </div>

            <div class="controls">
              <button class="btn" id="prevBtn" disabled>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" id="nextBtn">–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 2 -->
          <section class="page" data-i="1">
            <h2>–ó–∞ —á—Ç–æ —è —Ç–µ–±—è –ª—é–±–ª—é</h2>
            <p>–ï—Å–ª–∏ –±—ã –º–Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ –≤—ã–±—Ä–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏—á–∏–Ω (—Ö–æ—Ç—è –∏—Ö –Ω–∞–º–Ω–æ–≥–æ –±–æ–ª—å—à–µ):</p>
            <ul>
              <li>—Ç—ã —É–º–µ–µ—à—å –¥–µ–ª–∞—Ç—å –¥–∞–∂–µ –æ–±—ã—á–Ω—ã–µ –¥–Ω–∏ —Ç—ë–ø–ª—ã–º–∏ üå∑</li>
              <li>—Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –±—ã—Ç—å –ª—É—á—à–µ ‚Äî –±–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è, –ø—Ä–æ—Å—Ç–æ –ø–æ –ª—é–±–≤–∏ üíó</li>
              <li>–º–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, —Ç–≤–æ–π —Å–º–µ—Ö –∏ —Ç–æ, –∫–∞–∫ —Ç—ã —Å–º–æ—Ç—Ä–∏—à—å –Ω–∞ –º–∏—Ä ‚ú®</li>
              <li>—Ç—ã –Ω–∞—Å—Ç–æ—è—â–∞—è ‚Äî –∏ —ç—Ç–æ –±–µ—Å—Ü–µ–Ω–Ω–æ üå∏</li>
            </ul>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" data-next>–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 3 -->
          <section class="page" data-i="2">
            <h2>–ú–∞–ª–µ–Ω—å–∫–∏–π —Å—Ç–∏—Ö</h2>

            <div class="poem">
              <span class="line">–í —ç—Ç–æ–π –∂–∏–∑–Ω–∏ —Å–∏—Ä–æ—Ç–ª–∏–≤–æ–π,</span>
              <span class="line">–û–≥–Ω–æ–µ–º –¥–æ–≥–æ—Ä–∞—è –≤ —Å—Ç–∞—Ä–æ–π –∏–∑–±–µ,</span>
              <span class="line">–õ—é–¥–∏ –¥—É–º–∞—é—Ç –æ –∂–∏–∑–Ω–∏ –∫—Ä–∞—Å–∏–≤–æ–π,</span>
              <span class="line">–ê —è –¥—É–º–∞—é —Ç–æ–ª—å–∫–æ –æ —Ç–µ–±–µ...</span>
            </div>

            <div class="fire-emoji">‚ù§Ô∏è‚Äçüî•‚ù§Ô∏è‚Äçüî•‚ù§Ô∏è‚Äçüî•‚ù§Ô∏è‚Äçüî•</div>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" data-next>–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 4 -->
          <section class="page" data-i="3">
            <h2>–ü–∏—Å—å–º–æ –¥–ª—è —Ç–µ–±—è</h2>
            <p>
              –õ–µ—Ä–∞, —è –ª—é–±–ª—é —Ç–µ–±—è. –õ—é–±–ª—é –∑–∞ —Ç–≤–æ—é –Ω–µ–∂–Ω–æ—Å—Ç—å –∏ —Å–∏–ª—É, –∑–∞ —Ç–≤–æ—é —É–ª—ã–±–∫—É, –∑–∞ —Ç–æ,
              –∫–∞–∫ —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–ø–æ–∫–æ–π–Ω–æ. –¢—ã ‚Äî —á–µ–ª–æ–≤–µ–∫, –∫ –∫–æ—Ç–æ—Ä–æ–º—É —Ç—è–Ω–µ—Ç—Å—è –¥—É—à–∞.
            </p>
            <p>
              –°–ø–∞—Å–∏–±–æ, —á—Ç–æ —Ç—ã –µ—Å—Ç—å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏. –Ø —Ü–µ–Ω—é —Ç–µ–±—è ‚Äî –∏ —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å. üå∏
            </p>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" data-next>–î–∞–ª—å—à–µ ‚Üí</button>
            </div>
          </section>

          <!-- 5 -->
          <section class="page" data-i="4">
            <h2>–ò –Ω–∞–ø–æ—Å–ª–µ–¥–æ–∫‚Ä¶</h2>
            <p>
              –Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —É –Ω–∞—Å –±—ã–ª–æ –µ—â—ë –º–Ω–æ–≥–æ —Å—Ç—Ä–∞–Ω–∏—Ü ‚Äî —É–∂–µ –Ω–µ –Ω–∞ —Å–∞–π—Ç–µ, –∞ –≤ –∂–∏–∑–Ω–∏:
              —Ç—ë–ø–ª—ã—Ö, —Å–º–µ—à–Ω—ã—Ö, –≤–∞–∂–Ω—ã—Ö, –Ω–∞—Å—Ç–æ—è—â–∏—Ö. üíó
            </p>

            <div class="controls">
              <button class="btn" data-prev>‚Üê –ù–∞–∑–∞–¥</button>
              <button class="btn primary" id="surpriseBtn">–°—é—Ä–ø—Ä–∏–∑ ‚ú®</button>
            </div>
          </section>

        </div>
      </div>
    </section>
  </main>

  <script>
    /* ========= —Å—Ç—Ä–∞–Ω–∏—Ü—ã: –æ–±—ã—á–Ω–æ–µ –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏–µ ========= */
    const pages = Array.from(document.querySelectorAll(".page"));
    const counter = document.getElementById("counter");
    const bar = document.getElementById("bar");
    const prevBtn = document.getElementById("prevBtn");
    const nextBtn = document.getElementById("nextBtn");
    let idx = 0;
    let lock = false;

    function setUI(){
      counter.textContent = `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${idx+1} –∏–∑ ${pages.length}`;
      bar.style.width = Math.round(((idx+1)/pages.length)*100) + "%";
      if(prevBtn && nextBtn){
        prevBtn.disabled = idx === 0;
        nextBtn.textContent = (idx === pages.length-1) ? "–§–∏–Ω–∞–ª ‚Üí" : "–î–∞–ª—å—à–µ ‚Üí";
      }
    }

    function show(i, dir){
      pages.forEach(p => p.className = "page");
      const current = pages[idx];
      const next = pages[i];

      if(dir === 1) current.classList.add("exitLeft");
      if(dir === -1) current.classList.add("exitRight");

      next.classList.add("active");
      next.scrollTop = 0;

      idx = i;
      setUI();
    }

    function goNext(){
      if(lock || idx >= pages.length-1) return;
      lock = true;
      sprinkleFX(14);
      show(idx+1, 1);
      setTimeout(()=> lock=false, 560);
    }
    function goPrev(){
      if(lock || idx <= 0) return;
      lock = true;
      sprinkleFX(14);
      show(idx-1, -1);
      setTimeout(()=> lock=false, 560);
    }

    document.addEventListener("click", (e) => {
      const t = e.target;
      if(t.matches("[data-next]") || t === nextBtn) goNext();
      if(t.matches("[data-prev]") || t === prevBtn) goPrev();
    });
    if(prevBtn) prevBtn.addEventListener("click", goPrev);
    if(nextBtn) nextBtn.addEventListener("click", goNext);

    pages[0].classList.add("active");
    setUI();

    /* ========= —Ñ–æ–Ω/—ç—Ñ—Ñ–µ–∫—Ç—ã: –ª—ë–≥–∫–∏–µ ========= */
    const bgCanvas = document.getElementById("bgCanvas");
    const fxCanvas = document.getElementById("fxCanvas");
    const bg = bgCanvas.getContext("2d");
    const fx = fxCanvas.getContext("2d");

    function resize(c, ctx){
      c.width = Math.floor(window.innerWidth * devicePixelRatio);
      c.height = Math.floor(window.innerHeight * devicePixelRatio);
      c.style.width = window.innerWidth + "px";
      c.style.height = window.innerHeight + "px";
      ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
    }
    function resizeAll(){ resize(bgCanvas, bg); resize(fxCanvas, fx); }
    window.addEventListener("resize", resizeAll);
    resizeAll();

    const bgParts = [];
    const fxParts = [];
    const bgSyms = ["üåπ","üå∏","ü•Ä","üå∑","üíó","üíï","‚ú®","üíê"];
    const fxSyms = ["üíó","üíñ","üíï","‚ù§Ô∏è","üå∏","üå∑","‚ú®"];

    function add(arr, p){
      if(arr === bgParts && bgParts.length > 85) return;
      if(arr === fxParts && fxParts.length > 140) return;
      arr.push(p);
    }

    function spawnBG(n=1){
      const w = window.innerWidth;
      for(let i=0;i<n;i++){
        const sym = bgSyms[(Math.random()*bgSyms.length)|0];
        add(bgParts,{
          x: Math.random()*w,
          y: -60 - Math.random()*80,
          vx: (Math.random()*0.36 - 0.18),
          vy: 0.55 + Math.random()*0.9,
          g: 0.004 + Math.random()*0.006,
          size: 14 + Math.random()*12,
          a: 0.16 + Math.random()*0.12,
          da: 0.00060 + Math.random()*0.0007,
          rot: Math.random()*Math.PI*2,
          dr: (Math.random()*0.02 - 0.01),
          sym
        });
      }
    }

    function sprinkleFX(n=14){
      const w = window.innerWidth;
      for(let i=0;i<n;i++){
        const sym = fxSyms[(Math.random()*fxSyms.length)|0];
        add(fxParts,{
          x: Math.random()*w,
          y: -25 - Math.random()*45,
          vx: (Math.random()*0.9 - 0.45),
          vy: 1.0 + Math.random()*1.6,
          g: 0.03 + Math.random()*0.03,
          size: 16 + Math.random()*13,
          a: 0.95,
          da: 0.016 + Math.random()*0.014,
          rot: Math.random()*Math.PI*2,
          dr: (Math.random()*0.08 - 0.04),
          sym
        });
      }
    }

    let surpriseLock = false;
    function burstFX(){
      if(surpriseLock) return;
      surpriseLock = true;
      setTimeout(() => surpriseLock = false, 1500);

      const w = window.innerWidth, h = window.innerHeight;
      const COUNT = 50;
      for(let i=0;i<COUNT;i++){
        const sym = fxSyms[(Math.random()*fxSyms.length)|0];
        const x = Math.random()*w;
        const y = Math.random()*h;
        const ang = Math.random()*Math.PI*2;
        const sp = 1.6 + Math.random()*2.7;

        add(fxParts,{
          x,y,
          vx: Math.cos(ang)*sp,
          vy: Math.sin(ang)*sp - 0.7,
          g: 0.05 + Math.random()*0.05,
          size: 18 + Math.random()*18,
          a: 1,
          da: 0.014 + Math.random()*0.014,
          rot: Math.random()*Math.PI*2,
          dr: (Math.random()*0.10 - 0.05),
          sym
        });
      }
    }

    function step(ctx, arr){
      for(let i=arr.length-1;i>=0;i--){
        const p = arr[i];
        p.vy += p.g;
        p.x += p.vx;
        p.y += p.vy;
        p.vx *= 0.994;
        p.vy *= 0.994;
        p.rot += p.dr;
        p.a -= p.da;

        ctx.save();
        ctx.globalAlpha = Math.max(0, p.a);
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.font = `${p.size}px system-ui, Apple Color Emoji, Segoe UI Emoji`;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText(p.sym, 0, 0);
        ctx.restore();

        const out = (p.y > window.innerHeight + 120 || p.x < -160 || p.x > window.innerWidth + 160);
        if(p.a <= 0 || out) arr.splice(i,1);
      }
    }

    function loop(){
      bg.clearRect(0,0,window.innerWidth, window.innerHeight);
      fx.clearRect(0,0,window.innerWidth, window.innerHeight);
      step(bg, bgParts);
      step(fx, fxParts);
      requestAnimationFrame(loop);
    }
    loop();

    spawnBG(16);
    setInterval(() => spawnBG(1), 330);

    const surpriseBtn = document.getElementById("surpriseBtn");
    if(surpriseBtn) surpriseBtn.addEventListener("click", burstFX);

    /* ========= –º—É–∑—ã–∫–∞ ========= */
    const bgm = document.getElementById("bgm");
    const musicChip = document.getElementById("musicChip");

    async function tryAutoplay(){
      try{
        bgm.volume = 0.85;
        await bgm.play();
        musicChip.classList.remove("show");
      }catch(e){
        musicChip.classList.add("show");
      }
    }
    window.addEventListener("load", tryAutoplay);
    const once = () => { tryAutoplay(); window.removeEventListener("pointerdown", once); };
    window.addEventListener("pointerdown", once, {passive:true});
    musicChip.addEventListener("click", async () => {
      try{ await bgm.play(); musicChip.classList.remove("show"); }catch(e){}
    });
  </script>
</body>
</html>
